#! /usr/bin/env bqn

steps â† {""âŠ¸ğ•}âŒ¾(1âŠ¸âŠ‘) â€¢ImportÂ¨ "../singeli.bqn"â€¿"../emit_c.bqn"

n â† â‰ types â† "in"â€¿"ir"â€¿"c"
files â† â€¢file.List "."
typeâ€¿name â† typesâŠ¸âŠâŒ¾âŠ‘ <Ë˜â‰> (2âˆ¾ËœÂ·âˆ¨`âŒ¾âŒ½'.'âŠ¸=)âŠ¸âŠ”Â¨ files
filesâ€¿typeâ€¿name (â‹nameâ‰Ë˜type)âŠ¸âŠÂ¨â†©

Test â† {
  l â† 1-Ëœâ‰  t â† ğ•¨ (0<âŠ£)â—¶âŸ¨â€¢file.AtâŠ¢,â€¢file.CharsâŠ¢âŸ©Â¨ ğ•©
  m â† (1â†“t) â‰¡ t {ğ•ğ•©}Â´âŸœâŒ½Â¨â—‹(lâŠ¸â†‘) (Â¯1+`nâ†‘/â¼ğ•¨) âŠ” steps
  (Â¬m) / 2â†•ğ•©
}
gr â† âŠâˆ˜âŠ£âŒ¾((type<n)âŠ¸/)âŸœ(Â¯1Â¨) name
fail â† âˆ¾ type TestÂ¨â—‹(grâŠ¸âŠ”) files

â€¢Out {
  0=â‰ fail ? "All passed!"
;
  fâ†(âŒˆÂ´â‰ Â¨)âŠ¸(â†‘Â¨)âŠ¸((âˆ¾âŸœ" â†’ "âŠ¸âˆ¾)Â¨)Ë â‰fail
  Â¯1â†“âˆ¾âˆ¾âŸœ(@+10)Â¨ âŸ¨"Following steps failed:"âŸ©âˆ¾f
}
